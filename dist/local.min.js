function Menu(a){var b={span:"vertical",margin:{top:20,bottom:100,left:100,right:100},width:200,height:25,text_yoffset:18};this.config=_.extend(b,a),this.container=this.config.container,this.options=_.map(this.config.options,function(a,b){return _.extend(a,{idx:b})})}function ColorLegend(a){var b={swatch_size:13,intrapadding:5,position:{top:20,left:20},margin:{top:10,bottom:10,left:10,right:60},gap:15,extra:[]};this.config=_.extend(b,a),this.container=this.config.container}function Tooltip(a){var b={x:100,y:100,offset:{x:50,y:-20},width:300,height:300};this.config=_.extend(b,a),this.container=this.config.container,this.id=a.id||Math.random().toString().replace("0.","TOOLTIP-"),this.template=this.config.template,this.record={},this.x=this.config.x,this.y=this.config.y,this.width=this.config.width,this.height=this.config.height,this.offset=this.config.offset}function get_viewport(){var a,b;return void 0!==window.innerWidth?(a=window.innerWidth,b=window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):(a=document.getElementsByTagName("body")[0].clientWidth,b=document.getElementsByTagName("body")[0].clientHeight),[a,b]}Menu.prototype={constructor:Menu,render:function(){var a=this;a.control&&a.control.remove();var b=this.container.append("g").classed(a.config.classed||{menu:!0}).attr("transform",function(b,c){return"translate("+(Math.floor(a.config.margin.left)+.5)+","+(Math.floor(a.config.margin.top)+.5)+")"}),c=b.selectAll("g.option").data(this.options).enter().append("g").classed({option:!0,selected:function(a){return a.selected},disabled:function(a){return a.disabled}}).attr("transform",function(b,c){return"translate("+("horizontal"!==a.config.span?0:c*a.config.width)+","+("horizontal"===a.config.span?0:c*a.config.height)+")"});c.append("rect").attr("width",this.config.width).attr("height",this.config.height).on("click",function(d,e){if(d.disabled)return!1;b.selectAll("g.option.selected").classed({selected:!1}),d3.select(this.parentNode).classed({selected:!0}),_.each(a.options,function(a){a.selected=!(d.id!==a.id)}),_.isFunction(d.action)&&d.action.call(c,d)}),c.append("text").attr("x",10).attr("y",a.config.text_yoffset).text(function(a){return a.name}),a.control=b}},ColorLegend.prototype={set_scale:function(a){if(!a)throw new Error("Scale is undefined or invalid");this.scale=a},render:function(){var a=this;a.control&&a.control.remove();var b=this.scale.range(),c=a.config.margin.top+b.length*(a.config.swatch_size+a.config.intrapadding)-a.config.intrapadding+(_.isEmpty(a.config.extra)?0:a.config.gap+a.config.extra.length*(a.config.swatch_size+a.config.intrapadding))+a.config.margin.bottom,d=a.config.margin.left+a.config.swatch_size+a.config.margin.right,e=this.container.append("g").classed({legend:!0}).attr("transform",function(b,e){var f=a.config.position.top?a.config.position.top:a.container.attr("height")-c-a.config.position.bottom;return"translate("+((a.config.position.left?a.config.position.left:a.container.attr("width")-d-a.config.position.right)+.5)+","+(f+.5)+")"}),f=d3.scale.linear().domain([_.first(this.scale.domain()),_.last(this.scale.domain())]).range([b.length*(a.config.swatch_size+a.config.intrapadding)-a.config.intrapadding,0]);e.append("rect").attr("width",d).attr("height",c).attr("rx",6).attr("ry",6).style("stroke","#bbb").style("stroke-width",.5).style("fill","#ccc").style("fill-opacity",.85);e.selectAll("rect.swatch").data(b).enter().append("rect").classed({swatch:!0}).attr("x",a.config.margin.left).attr("y",function(c,d){return a.config.margin.top+(b.length-1-d)*(a.config.swatch_size+a.config.intrapadding)}).attr("rx",2).attr("ry",2).attr("width",a.config.swatch_size).attr("height",a.config.swatch_size).style("fill",function(a){return a}).style("stroke","#555").style("stroke-opacity",.7),e.selectAll("rect.extra").data(a.config.extra).enter().append("rect").classed({swatch:!0,extra:!0}).attr("x",a.config.margin.left).attr("y",function(c,d){return a.config.margin.top+b.length*(a.config.swatch_size+a.config.intrapadding)+a.config.gap+(a.config.extra.length-1-d)*(a.config.swatch_size+a.config.intrapadding)}).attr("rx",2).attr("ry",2).attr("width",a.config.swatch_size).attr("height",a.config.swatch_size).style("fill",function(a){return a[0]}).style("stroke","#555").style("stroke-opacity",.7);e.append("line").attr("x1",a.config.margin.left+a.config.swatch_size+7).attr("y1",Math.round(a.config.margin.top+a.config.swatch_size/2)).attr("x2",a.config.margin.left+a.config.swatch_size+7).attr("y2",Math.round(a.config.margin.top+b.length*(a.config.swatch_size+a.config.intrapadding)-a.config.intrapadding-a.config.swatch_size/2)).style("stroke","#555").style("stroke-opacity",.4),e.selectAll("line.tick1").data(b).enter().append("line").classed({tick1:!0}).attr("x1",a.config.margin.left+a.config.swatch_size+4).attr("y1",function(c,d){return Math.round(a.config.margin.top+((b.length-1-d)*(a.config.swatch_size+a.config.intrapadding)+a.config.swatch_size/2))}).attr("x2",a.config.margin.left+a.config.swatch_size+7).attr("y2",function(c,d){return Math.round(a.config.margin.top+((b.length-1-d)*(a.config.swatch_size+a.config.intrapadding)+a.config.swatch_size/2))}).style("stroke","#555").style("stroke-opacity",.4);var g=f.ticks(5);e.selectAll("line.tick2").data(g).enter().append("line").classed({tick2:!0}).attr("x1",a.config.margin.left+a.config.swatch_size+7).attr("y1",function(b,c){return Math.round(a.config.margin.top+Math.round(f(b)))}).attr("x2",a.config.margin.left+a.config.swatch_size+10).attr("y2",function(b,c){return Math.round(a.config.margin.top+Math.round(f(b)))}).style("stroke","#555").style("stroke-opacity",.4),e.selectAll("text.tick2").data(g).enter().append("text").classed({tick2:!0}).attr("x",a.config.margin.left+a.config.swatch_size+12).attr("y",function(b,c){return a.config.margin.top+f(b)+3}).text(function(b){return a.config.format(b)}),e.selectAll("line.tick2.extra").data(a.config.extra).enter().append("line").classed({tick2:!0,extra:!0}).attr("x1",a.config.margin.left+a.config.swatch_size+5).attr("y1",function(c,d){return Math.round(a.config.margin.top+b.length*(a.config.swatch_size+a.config.intrapadding)+a.config.gap+(a.config.extra.length-1-d)*(a.config.swatch_size+a.config.intrapadding)+a.config.swatch_size/2)}).attr("x2",a.config.margin.left+a.config.swatch_size+8).attr("y2",function(c,d){return Math.round(a.config.margin.top+b.length*(a.config.swatch_size+a.config.intrapadding)+a.config.gap+(a.config.extra.length-1-d)*(a.config.swatch_size+a.config.intrapadding)+a.config.swatch_size/2)}).style("stroke","#555").style("stroke-opacity",.4),e.selectAll("text.tick2.extra").data(a.config.extra).enter().append("text").classed({tick2:!0,extra:!0}).attr("x",a.config.margin.left+a.config.swatch_size+12).attr("y",function(c,d){return a.config.margin.top+b.length*(a.config.swatch_size+a.config.intrapadding)+a.config.gap+(a.config.extra.length-1-d)*(a.config.swatch_size+a.config.intrapadding)+8}).text(function(a){return a[1]}),a.control=e}},Tooltip.prototype={render:function(a){var b=this;this.remove();var c=this.container.append("g").attr("id",this.id).classed({tooltip:!0}).attr("transform",function(a,c){return"translate("+(b.x+.5)+","+(b.y+.5)+")"}).style("pointer-events","none");c.append("rect").attr("x",this.offset.x).attr("y",this.offset.y).attr("width",this.width).attr("height",this.height).attr("stroke","#555").attr("stroke-width",1).attr("stroke-opacity",.5).style("fill","#fff"),c.append("switch").append("foreignObject").attr("x",this.offset.x).attr("y",this.offset.y).attr("width",this.width).attr("height",this.height).append("xhtml:body").html(this.template(a))},remove:function(){this.container.select("g#"+this.id).remove()}};var map,overlay,appdata={},election_selector,div_selector,legend,selected_election=null,selected_sub=null,selected_div=null,app_options={opacity:.75};google.maps.event.addDomListener(window,"load",function(){d3.select("#top-glass").insert("rect","#title-text-1").attr("id","title-bg").attr("x",10.5).attr("y",10.5).attr("rx",2).attr("ry",2).attr("width",function(){return d3.select("#title-text-1").node().getBBox().width+22}).attr("height",58);var a=function(){var a=get_viewport();d3.select("#top-glass").attr("width",a[0]).attr("height",a[1]),legend&&legend.render();var b=Math.round(d3.select("#title-bg").attr("width")-10);d3.select("#description").attr("style","top:450px;left:10px;width:"+b+"px;height:"+Math.max(a[1]-500,0)+"px;"),d3.select("#source").attr("style","top:"+Math.max(a[1]-54,0)+"px;left:10px;width:"+b+"px;height:10px;")};d3.select(window).on("resize",a),a(),async.auto({data:function(a){d3.json("appdata.min.json",function(b){appdata=b,a()})},map:["data",function(a){map=new google.maps.Map(document.getElementById("map-canvas"),{center:{lat:7,lng:-66.1},zoom:6,minZoom:6,maxZoom:12,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.RIGHT_BOTTOM},scaleControl:!0,scaleControlOptions:{},streetViewControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.RIGHT_TOP},panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},styles:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#3178C8"},{lightness:-25},{saturation:-85}]}]}),google.maps.event.addListener(map.data,"addfeature",function(a){a.feature.setProperty("color","#359")}),overlay=new google.maps.OverlayView,overlay.draw=function(){},overlay.setMap(map),map.data.setStyle(function(a){var b=a.getProperty("hover"),c=a.getProperty("color")||"#999";return{strokeWeight:b?2:.5,strokeOpacity:1,strokeColor:b?"red":"#345",fillColor:b?d3.rgb(c).brighter(1.2):c,fillOpacity:app_options.opacity,zIndex:b?1:0}}),a()}],overlays:["data","map",function(a){function b(a){if(a&&a.feature){var b=overlay.getProjection().fromLatLngToContainerPixel(a.latLng),c=a.feature;if(f&&f.remove(),f=new Tooltip({container:g,x:b.x,y:b.y,width:280,height:150,template:_.template("<div style='width:100%;padding:10px 15px;'><span style='font-size:16px;color:#000;'><%=name || \"<span style='font-style:italic;color:#444;'>unknown</span>\"%></span><br><span style='color:#B98640;font-size:12px;'><%=loc%></span><br><br><table><tbody><tr><th><%=election.vtype%></th><td><%=value||'.'%></td></tr><tr><th>Turnout</th><td><%=turnout%></td></tr></tbody></table></div>")}),selected_election){var d=selected_election.id,e=selected_sub&&selected_sub[1]||"",h={};a.feature.forEachProperty(function(a,b){h[b]=a}),f.render(_.extend(h,{numformat:d3.format(","),value:(Math.round(1e3*c.getProperty(d+"_c"+e))/10).toString()+"%",rep_text:"pr12"===d||"pr13"===d?"Counted Voters<br> (<i>escrutados</i>)":"Registered Voters",registered:c.getProperty(d+"_n"),loc:c.getProperty("MUNICIPIO")?c.getProperty("MUNICIPIO")+", "+c.getProperty("ESTADO"):c.getProperty("ESTADO")||"",election:appdata.elections[d],area:google.maps.geometry.spherical.computeArea(c.getGeometry()),repinc:function(){return void 0===c.getProperty(appdata.elections[d].prev+"_n")||void 0===c.getProperty(d+"_n")||0===parseInt(c.getProperty(appdata.elections[d].prev+"_n"))||0===parseInt(c.getProperty(d+"_n"))?"<span style='font-style:italic;color:#777;'>N/A</span>":(Math.round(1e4*(parseInt(c.getProperty(d+"_n"))-parseInt(c.getProperty(appdata.elections[d].prev+"_n")))/parseInt(c.getProperty(appdata.elections[d].prev+"_n")))/100).toString()+"%"}(),turnout:function(){return void 0===c.getProperty(d+"_to"+e)?"<span style='font-style:italic;color:#777;'>N/A</span>":(Math.round(1e4*parseFloat(c.getProperty(d+"_to"+e)))/100).toString()+"%"}(),vdensity:void 0}))}}}function c(a){selected_div=a;var b=a.id;map.data.forEach(function(a){map.data.remove(a)}),map.data.addGeoJson(appdata[b]),selected_election&&d(selected_election)}function d(a){selected_election=a;var b=a.id,d=!1;if(_.each(div_selector.options,function(a){a.disabled=!(-1!==selected_election.maps.indexOf(a.id)),selected_div.id===a.id&&a.disabled&&(_.each(div_selector.options,function(a){a.selected=!1}),_.first(div_selector.options).selected=!0,c(_.first(div_selector.options)),d=!0)}),!d){if(div_selector.render(),selected_election.subs&&"circuitos"!==selected_div.id){if(!selected_sub)return selected_sub=_.first(selected_election.subs),void e(selected_sub[1])}else selected_sub=null;var f;if("sequential"==a.scale_type){var g=["#F7FCFD","#E5F5F9","#CCECE6","#99D8C9","#66C2A4","#41AE76","#238B45","#006D2C","#00441B"];f=d3.scale.linear().domain(g.map(function(a,b){return b/(g.length-1)})).range(g).clamp(!0)}else{var g=["#053061","#2166ac","#4393c3","#92c5de","#d1e5f0","#fddbc7","#f4a582","#d6604d","#b2182b","#67001f"];f=d3.scale.linear().domain(g.map(function(a,b){return b/(g.length-1)})).range(g).clamp(!0)}if(map.data.forEach(function(a){var c=a.getProperty(b+"_c"+(selected_sub?selected_sub[1]:""));c&&0!==c?a.setProperty("color",f(c)):a.setProperty("color","#666")}),legend.set_scale(f),legend.render(),$("#description").text(""),a.subs&&"circuitos"!==selected_div.id){var h=$("<select>");_.each(a.subs,function(a){var b=$("<option>").text(a[0]).val(a[1]);h.append(b)}),h.val(selected_sub),h.on("change",function(){e(h.val())}),$("#description").append("<span>Use electoral system:</span><br>").append(h).append("<br><br>")}$("<div>").html(a.desc).appendTo("#description")}}function e(a){_.isArray(selected_election.subs)&&(selected_sub=_.find(selected_election.subs,function(b){return b[1]===a}),d(selected_election))}var f,g=d3.select("#top-glass");google.maps.event.addListener(map.data,"mouseover",function(a){a&&a.feature&&(a.feature.setProperty("hover",!0),b(a))}),google.maps.event.addListener(map.data,"mouseout",function(a){a&&a.feature&&(a.feature.setProperty("hover",!1),f&&f.remove())}),map.addListener("dragstart",function(a){g.selectAll(".tooltip").remove()}),election_selector=new Menu({classed:{menu:1,elecsel:1},span:"vertical",options:_.map(appdata.elections,function(a,b){return{id:b,name:a.label,desc:a.desc,maps:a.maps,scale_type:a.scale_type,action:d,disabled:a.disabled,subs:a.subs,selected:a.selected}}),margin:{top:89,bottom:100,left:10,right:100},container:g,width:Math.round(d3.select("#title-bg").attr("width"))}),div_selector=new Menu({classed:{menu:1,divsel:1},span:"horizontal",options:[{id:"parroquias",name:"PARISH",action:c,selected:!0},{id:"municipios",name:"MUNICIP.",action:c},{id:"estados",name:"STATE",action:c},{id:"circuitos",name:"CIRCUIT",action:c}],margin:{top:68,left:10},container:g,width:d3.select("#title-bg").attr("width")/4,height:15,text_yoffset:11}),legend=new ColorLegend({swatch_size:10,intrapadding:3,position:{top:15,right:110},margin:{top:15,bottom:10,left:5,right:45},extra:[["#777","No data"]],container:g,format:function(a){return Math.round(100*a)+"%"}}),election_selector.render(),div_selector.render(),c(div_selector.options[0]),d(election_selector.options[election_selector.options.length-1])}]},function(a){a&&console.error(a)})});
//# sourceMappingURL=local.min.js.map